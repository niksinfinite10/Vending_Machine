<!DOCTYPE html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./css/bootstrap.css" >
	<style>
		.mylink{
			text-decoration:none;
		}
	</style>
  </head>
  <body>
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">IMG Vending Machine</h1>
        </div>
        <div class="col-md-9">
          <div class="col-md-4 thumb">
            <a class="thumbnail mylink" href="javacsript:void(0)" onClick="buyItem('cola')" >
              <img class="img-responsive" src="./img/cocke.png" alt="">
            <span class="text-center">[1.] $1.00 cola</span>
            </a>

          </div>
          <div class="col-md-4 thumb">
            <a class="thumbnail mylink" href="javacsript:void(0)" onClick="buyItem('chips')" >
              <img class="img-responsive" src="./img/chips.png" alt="">
              2. $0.50 chips
            </a>
          </div>
          <div class="col-md-4 thumb">
            <a class="thumbnail mylink" href="javacsript:void(0)" onClick="buyItem('candy')"  >
              <img class="img-responsive" src="./img/candy.png" alt="">
              3. $0.65 candy
            </a>
          </div>
        </div>

        <div class="col-md-3">
          <div class="row ">
            <div class="panel panel-default">
              <div class="panel-body">
                    <div class="form-group">
                        <input id="displayMessage" type="text" class="form-control" value="INSERT COIN" readonly="true" />
                    </div>
                  <div class="col-md-12">
                    <h4 style="display:block">Please select</h4>
                  </div>
                  <div style="margin-top:10px;" class="text-center">
                    <button class="btn btn-default" onClick="buyItem('cola')" >1</button>
                    <button class="btn btn-default" onClick="buyItem('chips')">2</button>
                    <button class="btn btn-default" onClick="buyItem('candy')">3</button>
                  </div>
                  <div class="col-md-12">
                    <h4 style="display:block">Coins</h4>

                  <div class="row" style="margin-bottom:20px;" >
                    <div style="margin-top:10px;" class="text-center">
                      <button class="btn btn-default " data-coin-name="penny" >$0.01</button>
                      <button class="btn btn-default " data-coin-name="nickel" >$0.5</button>
                      <button class="btn btn-default " data-coin-name="dime" >$0.10</button>
                    </div>
                    <div style="margin-top:10px;" class="text-center">
                      <button class="btn btn-default" data-coin-name="quarter" >$0.25</button>
                      <button class="btn btn-default" data-coin-name="half" >$0.50</button>
                      <button class="btn btn-default" data-coin-name="dollar" >$1.00</button>
                    </div>
                  </div>
                  </div>
                      <div class="form-group">
                    <input  type="button" class="btn btn-primary btn-block" value="Return Coins" onClick="returnCoin()" />
                  </div>
                  <div class="col-md-12">
                    <h4 style="display:block">Coins Returns</h4>
                  </div>
                  <div class="form-group">
                      <input id="returnBox" type="text" class="form-control" value=""  readonly="true" />
                  </div>
                </div>
             </div>
           </div>
        </div>
      </div>
      <script src="./js/vending_machine.js"></script>
      <script>

      let vendingMachin =undefined;
      let dispMsg = '';
      let blicking = undefined;

      window.onload = function(){
        let coinButton = document.querySelectorAll('[data-coin-name]');
        for(let i=0;i<coinButton.length;i++){
              coinButton[i].addEventListener("click", coinInserted);
        }
        vendingMachine = new VendingMachine();
        printMessage(vendingMachine.displayMessage);
      }

      function printMessage(mesg,msgbox){
        if(msgbox)
          document.getElementById('returnBox').value = mesg;
        else{
          //TODO: display message for sold item more efficiently
          document.getElementById('displayMessage').value = mesg;
        }
      }

    function clearBlinking(){
      console.log('interval is not clearing');
      clearInterval(window.blicking);
      window.blicking = false;
    }

    function blickingMsg(msgArr){
      let i =0;
      //FIXME: dynamicaly shows the messages
      clearBlinking();
      window.blicking =  setInterval(function(){
          if(i%2==0)
            document.getElementById('displayMessage').value = msgArr[0];
          else
            document.getElementById('displayMessage').value = msgArr[1];
          i++;
        },500);
    }

      function buyItem(item){
          console.log('this is console',item);
           let result = vendingMachine.selectItem(item);
           let i =0;
           if(result[0] === 'THANK YOU')
              printMessage(result[2],'returnBox');
           blickingMsg(result);
        }

      function returnCoin(){
          clearBlinking();
          vendingMachine.returnCoin();
          printMessage(vendingMachine.change,'returnBox');
          printMessage(vendingMachine.displayMessage);
      }

        function coinInserted(){
          clearBlinking();
          let coinName = this.getAttribute("data-coin-name");
          if(vendingMachine.isValidCoin(coinName)){
              vendingMachine.acceptCoin(coinName);
            printMessage(vendingMachine.displayMessage);
          }
          else{
            printMessage('Not valid coin',"returnBox");
            setTimeout(function(){ printMessage('',"returnBox");}, 500);
          }
}


      </script>
  </body>
</html>
